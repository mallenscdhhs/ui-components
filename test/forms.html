<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Components</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="Components.js"></script>
    <script src="shim.js"></script>
    <!-- Demo Form -->
    <script src="lib/data/editor/testData.js"></script>
    <!-- Load editors data async or live TODO: REMOVE make ASYNC-->
    <script src="lib/data/editor/editors.js"></script>
    <!-- Meta service for dropdown values TODO: REMOVE-->
    <script src="lib/data/editor/services.js"></script>
    <style>
      .btn{margin:0 3px;}
      .config-editor{ width:auto; height:25px; line-height:25px; position:absolute; top:0; right:4px; display:none; box-sizing:border-box; padding: 0; cursor:pointer; z-index:9999; color:#999; }
      *{ position:relative; }
      .enable-component-editor .editable-component:hover > .config-editor,
      .enable-component-editor .config-editor:hover{ display:block; }
      .enable-component-editor .editable-component:hover > .config-editor:hover { color: #337ab7; }
    </style>
  </head>
  <body style="padding: 2em;">

      <div id="component-page" class="enable-component-editor"></div>

      <script>
        var _ = require('underscore');
        var Queue = Components.eventQueue;
        var EditorConfig = Components.editorConfig;

        var Form = Components.factory(formFixture);
        React.render(Form,document.getElementById('component-page'));

        // Forms cache, load only once, after the first use, then cache
        var forms = {
          'field' : fieldForm,
          'fieldset' : null,
          'action' : null,
          'container' : null,
          'form' : null,
          'page' : null
        };


        Queue.subscribe('all','globalEditor',function(data,eventType){
          if(eventType.indexOf('component:edit') >= 0){

            var editForm = EditorConfig.mergeFormAndData(forms[data.type],data);
            var editFormFieldNames = EditorConfig.getFieldNames(editForm);

            // Setup Editor
            var EditorForm = Components.factory(editForm);
            document.getElementById('editComponentModalLabel').innerText = data.type.toUpperCase() + ' Component Editor'
            var container = document.getElementById('edit-modal-container');
            container.innerHTML = '';
            React.render(EditorForm,container);

            $('#editComponentModal').modal('show');

          }
        });

      </script>
      <div class="modal fade" id="editComponentModal" tabindex="-1" role="dialog" aria-labelledby="editComponentModal" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="editComponentModalLabel">Component Editor</h4>
            </div>
            <div class="modal-body" id="edit-modal-container"></div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary pull-right" id="update-field">Update</button>
            </div>
          </div>
        </div>
      </div>
  </body>
</html>
